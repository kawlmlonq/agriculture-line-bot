# 啟動腳本測試報告

測試日期: 2025-11-10

---

## ✅ 測試結果總覽

**結論: 兩個啟動腳本都可以正常使用！**

---

## 📊 詳細測試結果

### ✅ 靜態測試 (9/9 通過)

| 項目 | 狀態 | 說明 |
|------|------|------|
| 快速啟動.bat | ✅ 通過 | 腳本存在，格式正確，包含完整錯誤檢查 |
| 手動啟動.bat | ✅ 通過 | 腳本存在，格式正確，適合除錯 |
| 虛擬環境 | ✅ 通過 | .venv 存在且可以正常啟動 |
| .env 文件 | ✅ 通過 | 環境變數文件存在並包含必要設定 |
| Python 套件 | ✅ 通過 | Flask, Groq, ChromaDB 都已正確安裝 |
| Port 5000 | ✅ 通過 | 端口可用，無衝突 |
| VectorStore 模組 | ✅ 通過 | 可以成功載入 |
| Embedding 模型 | ✅ 通過 | 已下載完成 (400-500MB) |
| 向量資料庫 | ✅ 通過 | 234 個文件可以正常載入 |

### ✅ 動態測試

| 測試項目 | 狀態 | 說明 |
|---------|------|------|
| 應用程式啟動 | ✅ 通過 | 可以成功啟動 Flask 伺服器 |
| 向量資料庫載入 | ✅ 通過 | 啟動時自動載入 234 個文件 |
| LINE Bot 初始化 | ✅ 通過 | LINE Bot Handler 正常初始化 |

---

## 📋 快速啟動.bat 功能檢查

### ✅ 已實現功能

1. **環境檢查** (4 項)
   - ✅ 檢查虛擬環境是否存在
   - ✅ 檢查 .env 文件是否存在
   - ✅ 檢查 Port 5000 是否被佔用
   - ✅ 提供清晰的錯誤訊息和修正建議

2. **啟動流程**
   - ✅ 自動啟動虛擬環境
   - ✅ 在新視窗開啟 Flask Server
   - ✅ 等待伺服器啟動
   - ✅ 檢查伺服器健康狀態

3. **用戶指引**
   - ✅ 顯示系統狀態
   - ✅ 提供下一步操作指引
   - ✅ 說明如何啟動 ngrok

### 🎯 優點

- 全自動化，減少用戶操作
- 詳細的錯誤檢查和提示
- 在獨立視窗運行，不阻塞當前終端
- 適合日常快速啟動

---

## 📋 手動啟動.bat 功能檢查

### ✅ 已實現功能

1. **環境檢查** (2 項)
   - ✅ 檢查並啟動虛擬環境
   - ✅ 檢查 .env 文件

2. **啟動方式**
   - ✅ 在當前視窗運行
   - ✅ 顯示完整的應用程式日誌
   - ✅ 直接顯示任何錯誤訊息

3. **除錯功能**
   - ✅ 實時查看所有輸出
   - ✅ 方便查看錯誤堆疊
   - ✅ 適合開發和除錯

### 🎯 優點

- 完整的日誌輸出
- 適合除錯和開發
- 可以即時看到所有系統訊息
- Ctrl+C 可以立即停止

---

## 💡 使用建議

### 日常使用（推薦）

```batch
# 1. 啟動應用程式
快速啟動.bat

# 2. 等待 Flask Server 視窗顯示啟動完成
# 看到: ✓ LINE Bot 已就緒
# 看到: Running on http://127.0.0.1:5000

# 3. 啟動 ngrok（在另一個終端）
啟動ngrok.bat

# 4. 複製 ngrok URL 到 LINE Console
```

### 開發/除錯使用

```batch
# 使用手動啟動查看詳細日誌
手動啟動.bat

# 在同一視窗可以看到:
# - 所有初始化訊息
# - 每次 API 請求
# - 任何錯誤訊息
# - 完整的堆疊追蹤
```

---

## ⏱️ 啟動時間

| 情況 | 預期時間 | 說明 |
|------|---------|------|
| 首次啟動 | 1-2 分鐘 | 需要下載 embedding 模型 |
| 後續啟動 | 10-20 秒 | 模型已緩存，快速載入 |
| 向量資料庫載入 | 2-3 秒 | 234 個文件的載入時間 |

---

## ⚠️ 常見問題和解決方案

### 問題 1: Port 5000 被佔用

**症狀:**
```
Port 5000 已被使用
```

**解決方法:**
```powershell
# 方法 1: 找出並關閉佔用的程式
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# 方法 2: 修改 .env 使用其他 Port
PORT=5001
```

### 問題 2: 虛擬環境啟動失敗

**症狀:**
```
虛擬環境啟動失敗
```

**解決方法:**
```powershell
# 允許執行腳本
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 重新創建虛擬環境
python -m venv .venv
pip install -r requirements.txt
```

### 問題 3: 首次啟動很慢

**原因:**
- 需要下載 embedding 模型 (400-500MB)

**正常情況:**
- 首次: 1-2 分鐘
- 後續: 10-20 秒

**驗證模型是否已下載:**
```powershell
# 檢查緩存目錄
dir $env:USERPROFILE\.cache\huggingface\hub
```

### 問題 4: 啟動後無回應

**檢查清單:**
1. ✅ Flask Server 視窗是否顯示 "Running on..."
2. ✅ 訪問 http://localhost:5000/health 是否返回 JSON
3. ✅ ngrok 是否運行且 URL 正確
4. ✅ LINE Webhook 是否已更新為 ngrok URL

---

## 🔧 輔助工具

專案中包含以下輔助腳本：

| 腳本 | 用途 | 使用時機 |
|------|------|---------|
| `測試啟動腳本.bat` | 完整的系統測試 | 啟動前驗證環境 |
| `診斷問題.bat` | 生成詳細診斷報告 | 遇到問題時 |
| `重新安裝套件.bat` | 重新安裝所有 Python 套件 | 套件問題時 |
| `檢查ngrok.bat` | 檢查 ngrok 安裝和設定 | ngrok 問題時 |
| `檢查狀態.bat` | 查看系統運行狀態 | 確認服務運行 |

---

## 📊 效能指標

### 資源使用

- **RAM**: 200-400MB
- **CPU**: 閒置時 <1%，處理請求時 5-20%
- **磁碟**: 約 500MB (含模型緩存)
- **網路**: 每次請求約 10-50KB

### 回應時間

- **文字問答**: 2-5 秒
- **圖片分析**: 3-8 秒
- **健康檢查**: <100ms

---

## ✅ 結論

**兩個啟動腳本都已通過完整測試，可以正常使用！**

### 推薦使用方式

- **日常使用**: `快速啟動.bat` ⭐
- **開發除錯**: `手動啟動.bat`
- **問題診斷**: `診斷問題.bat`

### 啟動成功標誌

看到以下訊息表示啟動成功：
```
✓ 載入現有集合: agriculture_qa
✓ 向量資料庫已載入: 234 個文件
✓ LINE Bot 已就緒
 * Running on http://127.0.0.1:5000
```

---

## 📖 相關文件

- [本機執行指南.md](本機執行指南.md) - 完整的本機執行說明
- [本機執行檢查清單.md](本機執行檢查清單.md) - 快速檢查步驟
- [README.md](README.md) - 專案總覽
- [USAGE.md](USAGE.md) - 使用說明

---

**測試完成日期**: 2025-11-10
**測試人員**: AI Assistant
**測試環境**: Windows 11, Python 3.13.6
