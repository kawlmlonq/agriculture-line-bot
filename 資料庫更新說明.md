# 📚 資料庫更新說明

## ✨ 智能載入功能

系統現在會自動追蹤檔案狀態，只處理新增或修改的檔案！

### 🔍 功能特點

1. **自動偵測**
   - ✅ 跳過未變更的檔案
   - 🆕 自動識別新增的檔案
   - 📝 自動識別修改的檔案

2. **節省時間**
   - 只處理需要更新的檔案
   - 避免重複向量化已處理的檔案
   - 大幅縮短更新時間

3. **檔案追蹤**
   - 使用 MD5 hash 追蹤檔案變更
   - 記錄處理時間和狀態
   - 追蹤記錄位於：`vector_db/file_tracking.json`

### 📋 使用方法

#### 方法 1：使用批次檔（推薦）
```
雙擊：更新資料庫.bat
```

#### 方法 2：使用命令列
```powershell
# 啟動虛擬環境
.\.venv\Scripts\Activate.ps1

# 執行智能載入
python scripts\smart_load_data.py
```

### 📊 執行範例

**首次執行：**
```
📊 掃描結果:
   ✅ 未變更檔案: 0 個
   🆕 新增檔案: 2 個
   📝 修改檔案: 0 個

🆕 新增檔案:
   • 水稻栽培管理技術手冊.pdf
   • 玉米種植.pdf

總共需要處理 2 個檔案
```

**第二次執行（檔案未變更）：**
```
📊 掃描結果:
   ✅ 未變更檔案: 2 個
   🆕 新增檔案: 0 個
   📝 修改檔案: 0 個

✅ 所有檔案都已是最新狀態，無需更新！
```

**新增檔案後：**
```
📊 掃描結果:
   ✅ 未變更檔案: 2 個
   🆕 新增檔案: 1 個
   📝 修改檔案: 0 個

✅ 未變更檔案（跳過）:
   • 水稻栽培管理技術手冊.pdf
   • 玉米種植.pdf

🆕 新增檔案:
   • 蔬菜栽培指南.pdf

總共需要處理 1 個檔案
```

### 🔄 完全重建資料庫

如果您想要清除所有資料並重新載入：

```powershell
# 使用舊版載入方式
python scripts\load_data.py
# 然後選擇 'y' 清除並重新載入
```

### 📂 支援的檔案格式

- 📄 `.txt` - 純文字檔案
- 📕 `.pdf` - PDF 文件
- 📘 `.docx` - Word 文件
- 📊 `.xlsx` - Excel 試算表

### 💡 實用技巧

#### 查看追蹤記錄
```powershell
Get-Content .\vector_db\file_tracking.json | ConvertFrom-Json | ConvertTo-Json
```

#### 手動重置追蹤記錄
```powershell
Remove-Item .\vector_db\file_tracking.json
```
然後重新執行載入腳本，所有檔案會被視為新檔案。

#### 檢查檔案狀態
系統會自動顯示每個檔案的狀態，無需手動檢查。

### 🎯 最佳實踐

1. **定期更新**
   - 新增資料後立即執行更新
   - 系統只會處理新增/修改的檔案

2. **批次新增**
   - 可以一次放入多個新檔案
   - 系統會自動處理所有新檔案

3. **檔案管理**
   - 不要重新命名已處理的檔案
   - 如果需要更新內容，直接修改檔案即可

4. **定期備份**
   - 建議定期備份 `vector_db` 資料夾
   - 包含追蹤記錄和向量資料

### ⚙️ 進階設定

如果需要調整分割參數，可以修改腳本中的：
```python
chunked_docs = loader.chunk_documents(
    all_docs, 
    chunk_size=500,  # 每個區塊的字數
    overlap=50       # 區塊之間的重疊字數
)
```

---

## 📞 疑難排解

**Q: 檔案明明修改了，但系統說未變更？**
A: 請確認檔案內容確實有改變。系統使用 MD5 hash 偵測變更。

**Q: 想要強制重新處理所有檔案？**
A: 刪除 `vector_db/file_tracking.json` 檔案，或使用 `python scripts\load_data.py`

**Q: 系統誤判檔案狀態？**
A: 刪除追蹤記錄檔案，重新執行載入。

**Q: 追蹤記錄檔案在哪裡？**
A: `vector_db/file_tracking.json`

---

✅ **智能載入功能讓資料更新更快速、更有效率！**
