# 📝 提示詞自訂指南

## 📍 提示詞位置

所有提示詞現在集中管理在 **`prompts.py`** 檔案中！

### 檔案結構：
```
agriculture-line-bot/
├── prompts.py          ← 所有提示詞都在這裡！
├── src/
│   ├── qa_engine.py    ← 問答系統（引用 prompts.py）
│   ├── image_analyzer.py ← 圖片分析（引用 prompts.py）
│   └── line_bot.py     ← LINE Bot（引用 prompts.py）
```

---

## 🎯 可自訂的提示詞

### 1. 問答系統提示詞

#### A. 系統角色提示詞
```python
Prompts.QA_SYSTEM_PROMPT
```
**用途：** 定義 AI 的角色和行為
**預設值：** "你是一位專業的農業顧問..."

#### B. 使用者問題提示詞
```python
Prompts.QA_USER_PROMPT_TEMPLATE
```
**用途：** 引導 AI 如何回答問題
**變數：** `{context}`, `{question}`

---

### 2. 圖片分析提示詞

#### A. 帶問題的圖片分析
```python
Prompts.IMAGE_ANALYSIS_WITH_QUESTION
```
**用途：** 當使用者有特定問題時
**變數：** `{question}`

#### B. 一般圖片分析
```python
Prompts.IMAGE_ANALYSIS_GENERAL
```
**用途：** 沒有特定問題時的全面分析

#### C. 快速識別
```python
Prompts.IMAGE_QUICK_IDENTIFY
```
**用途：** 簡短描述圖片內容

---

### 3. 使用者介面訊息

#### 幫助訊息
```python
Prompts.HELP_MESSAGE
Prompts.ABOUT_MESSAGE
Prompts.TOPICS_MESSAGE
```

#### 回應訊息
```python
Prompts.IMAGE_PROCESSING      # "正在分析圖片..."
Prompts.IMAGE_RESULT_PREFIX   # "圖片分析結果："
Prompts.IMAGE_RESULT_SUFFIX   # "如果想詢問更多..."
Prompts.ERROR_MESSAGE         # 錯誤訊息
```

---

## ✏️ 如何自訂提示詞

### 方法 1：直接修改 prompts.py（推薦）

1. **開啟檔案**
   ```bash
   # 使用 VS Code 開啟
   code prompts.py
   ```

2. **找到要修改的提示詞**
   ```python
   class Prompts:
       QA_SYSTEM_PROMPT = """你是一位專業的農業顧問..."""
   ```

3. **修改內容**
   ```python
   class Prompts:
       QA_SYSTEM_PROMPT = """你是一位經驗豐富的老農夫，用親切的方式分享農業知識..."""
   ```

4. **儲存並重啟伺服器**
   ```bash
   # 停止 Flask（Ctrl+C）
   # 重新啟動
   .\快速啟動.bat
   ```

---

### 方法 2：使用自訂提示詞類別

1. **在 prompts.py 中新增自訂類別**
   ```python
   class MyCustomPrompts:
       """我的自訂提示詞"""
       
       QA_SYSTEM_PROMPT = """你是台灣農業改良場的專家..."""
       
       QA_USER_PROMPT_TEMPLATE = """
       參考台灣農業技術文獻：
       {context}
       
       農民的問題：{question}
       
       請提供適合台灣氣候的建議...
       """
   ```

2. **修改 src/qa_engine.py 引用**
   ```python
   from prompts import MyCustomPrompts
   
   class QAEngine:
       def __init__(self, vector_store):
           # ...
           self.prompts = MyCustomPrompts  # 改用自訂提示詞
   ```

---

## 💡 提示詞優化技巧

### 1. 問答系統優化

#### 讓回答更專業：
```python
QA_SYSTEM_PROMPT = """你是台灣農業研究所的資深研究員，
擁有 20 年田間實務經驗。請提供科學且實用的建議。"""
```

#### 讓回答更親切：
```python
QA_SYSTEM_PROMPT = """你是一位經驗豐富的老農夫，
用輕鬆、口語化的方式，像朋友聊天一樣分享農業知識。"""
```

#### 讓回答更簡潔：
```python
QA_USER_PROMPT_TEMPLATE = """
資料：{context}
問題：{question}

要求：
- 直接切入重點
- 3-5 個要點
- 不超過 200 字
"""
```

---

### 2. 圖片分析優化

#### 增加病蟲害診斷能力：
```python
IMAGE_ANALYSIS_GENERAL = """你是植物病理學專家。
請仔細觀察圖片並提供：

1. **病徵描述**：詳細描述看到的症狀
2. **可能病因**：列出 2-3 種可能的病蟲害
3. **診斷依據**：說明判斷的理由
4. **處理建議**：提供具體的防治方法
5. **預防措施**：如何避免再次發生

重點放在精準診斷和實用建議。"""
```

#### 增加作物評估：
```python
IMAGE_ANALYSIS_GENERAL = """你是作物栽培專家。
請評估圖片中的作物狀況：

1. **生長階段**：判斷目前的生長期
2. **健康狀態**：評分 0-10 分
3. **營養狀況**：是否有缺素症狀
4. **栽培建議**：下一步該做什麼
5. **預估產量**：根據目前狀況的產量預測

用專業但易懂的方式說明。"""
```

---

## 🧪 測試提示詞效果

### 1. 測試問答提示詞
```bash
# 使用測試 endpoint
curl -X POST http://localhost:5000/test \
  -H "Content-Type: application/json" \
  -d '{"question":"水稻什麼時候種？"}'
```

### 2. 測試圖片分析提示詞
```bash
# 使用測試腳本
python test_image_analysis.py test_image.jpg
```

### 3. LINE 實際測試
- 傳送問題到 LINE Bot
- 觀察回答的風格和內容
- 根據效果調整提示詞

---

## 📊 提示詞範例庫

### 風格 1：學術專業型
```python
QA_SYSTEM_PROMPT = """你是農業科學研究員，
請提供基於科學證據的專業分析，
並引用相關研究文獻。"""
```

### 風格 2：實務經驗型
```python
QA_SYSTEM_PROMPT = """你是有 30 年經驗的農場主，
分享實際操作的訣竅和注意事項，
用簡單的話說明複雜的道理。"""
```

### 風格 3：教學指導型
```python
QA_SYSTEM_PROMPT = """你是農業推廣教師，
用循序漸進的方式教導農業技術，
確保初學者也能理解。"""
```

### 風格 4：問題解決型
```python
QA_SYSTEM_PROMPT = """你是農業診療顧問，
專門解決農民遇到的具體問題，
提供立即可行的解決方案。"""
```

---

## 🔄 版本控制建議

### 保存原始版本
```python
class Prompts:
    # 原始版本
    QA_SYSTEM_PROMPT_V1 = """原始提示詞..."""
    
    # 目前使用
    QA_SYSTEM_PROMPT = QA_SYSTEM_PROMPT_V1
    
    # 測試版本
    QA_SYSTEM_PROMPT_TEST = """測試新的提示詞..."""
```

### 輕鬆切換
```python
# 測試新版本
self.prompts.QA_SYSTEM_PROMPT = self.prompts.QA_SYSTEM_PROMPT_TEST

# 恢復原版本
self.prompts.QA_SYSTEM_PROMPT = self.prompts.QA_SYSTEM_PROMPT_V1
```

---

## ⚠️ 注意事項

### 1. 變數佔位符
使用 `format()` 時確保變數名稱正確：
```python
# ✅ 正確
QA_USER_PROMPT_TEMPLATE = """
參考資料：{context}
問題：{question}
"""

# ❌ 錯誤
QA_USER_PROMPT_TEMPLATE = """
參考資料：{ctx}      # 變數名稱不符
問題：{q}            # 變數名稱不符
"""
```

### 2. 繁體中文
確保提示詞使用繁體中文，AI 回答才會是繁體：
```python
# ✅ 正確
"請用繁體中文回答"

# ❌ 避免
"请用简体中文回答"
```

### 3. 長度限制
- 提示詞不要太長（建議 < 500 字）
- 太長會影響回應速度
- 重點要明確具體

### 4. 測試充分
- 修改後一定要測試
- 測試多種問題類型
- 確認回答品質

---

## 📝 修改紀錄範本

建議在 prompts.py 加入修改記錄：

```python
"""
修改紀錄：

2025-11-09:
- 初始版本
- 建立集中管理的提示詞系統

2025-11-10:
- 調整 QA_SYSTEM_PROMPT，增加親和力
- 優化 IMAGE_ANALYSIS_GENERAL，強化病蟲害診斷

自訂說明：
- 本專案使用 Groq LLM (llama-3.3-70b)
- 提示詞需考慮繁體中文回答
- 農業專業性和易懂性需平衡
"""
```

---

## 🎯 快速開始

1. **開啟提示詞檔案**
   ```bash
   code prompts.py
   ```

2. **選擇要修改的提示詞**
   - QA_SYSTEM_PROMPT（問答角色）
   - QA_USER_PROMPT_TEMPLATE（問答格式）
   - IMAGE_ANALYSIS_GENERAL（圖片分析）

3. **修改並儲存**

4. **重啟伺服器**
   ```bash
   .\快速啟動.bat
   ```

5. **測試效果**
   - 在 LINE 問問題
   - 傳送圖片
   - 觀察回答

6. **調整優化**
   - 根據效果繼續調整
   - 記錄修改內容

---

**現在您可以完全掌控 AI 的回答風格了！** 🎨
