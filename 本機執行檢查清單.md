# 本機執行檢查清單 ✅

快速確認您的系統是否準備好執行農業 LINE Bot。

---

## 📋 環境檢查

### ✅ 步驟 1：Python 環境

```powershell
# 檢查 Python 版本
python --version
```
**預期結果**：`Python 3.13.x`

---

### ✅ 步驟 2：虛擬環境

```powershell
# 啟動虛擬環境
.\.venv\Scripts\Activate.ps1

# 檢查套件
python -c "import flask, groq, chromadb; print('✅ 所有套件已安裝')"
```
**預期結果**：`✅ 所有套件已安裝`

---

### ✅ 步驟 3：環境變數

```powershell
# 檢查 .env 檔案
Get-Content .env
```

**必要設定**：
- ✅ `LINE_CHANNEL_ACCESS_TOKEN=xxxxx`
- ✅ `LINE_CHANNEL_SECRET=xxxxx`
- ✅ `GROQ_API_KEY=xxxxx`

---

### ✅ 步驟 4：向量資料庫

```powershell
python -c "from src.vector_store import VectorStore; vs = VectorStore(); print(f'✅ 向量資料庫包含 {vs.collection.count()} 個文件')"
```
**預期結果**：`✅ 向量資料庫包含 234 個文件`

---

## 🚀 啟動檢查

### ✅ 步驟 5：啟動應用

```powershell
# 使用快速啟動腳本
.\快速啟動.bat
```

**成功訊息**：
```
✅ 向量資料庫已載入，包含 234 個文件塊
 * Running on http://127.0.0.1:5000
```

---

### ✅ 步驟 6：測試本地連線

開啟瀏覽器，訪問：
- http://localhost:5000/health

**預期結果**：
```json
{
  "status": "healthy",
  "vector_db": {
    "status": "loaded",
    "documents": 234
  }
}
```

---

### ✅ 步驟 7：安裝 ngrok

**檢查是否已安裝**：
```powershell
where ngrok
```

**如未安裝**，選擇一種方式：

**方式 A（推薦）**：
```powershell
choco install ngrok
```

**方式 B**：
- 前往 https://ngrok.com/download
- 下載 Windows 版本
- 解壓到 `C:\ngrok\`

---

### ✅ 步驟 8：設定 ngrok

```powershell
# 設定 authtoken（從 ngrok.com/dashboard 取得）
ngrok config add-authtoken YOUR_AUTHTOKEN_HERE
```

---

### ✅ 步驟 9：啟動 ngrok

```powershell
.\啟動ngrok.bat
```

**成功訊息**：
```
Forwarding   https://xxxx-xxx.ngrok-free.app -> http://localhost:5000
```

**複製這個網址**！

---

### ✅ 步驟 10：更新 LINE Webhook

1. 前往 https://developers.line.biz/console/
2. 選擇您的 Channel
3. Messaging API → Webhook URL
4. 輸入：`https://your-ngrok-url.ngrok-free.app/callback`
5. 點擊 **Verify** 驗證
6. 點擊 **Update** 儲存
7. 開啟 **Use webhook** 開關

---

### ✅ 步驟 11：測試 LINE Bot

1. 用手機開啟 LINE
2. 傳送訊息給您的 Bot
3. 應該會收到回覆！

**測試問題**：
- "你好"
- "水稻怎麼種植？"
- 上傳一張植物照片

---

## ⚠️ 常見問題

### 問題：Port 5000 被佔用

```powershell
# 查看並關閉佔用的程式
netstat -ano | findstr :5000
taskkill /PID <PID> /F
```

### 問題：虛擬環境無法啟動

```powershell
# 允許執行腳本
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 問題：LINE Bot 無回應

檢查清單：
- [ ] 本機應用程式運行中？
- [ ] ngrok 運行中且網址正確？
- [ ] LINE Webhook 已設定並驗證成功？
- [ ] Webhook 開關已開啟？

---

## 📊 系統狀態命令

```powershell
# 查看應用程式狀態
.\檢查狀態.bat

# 或手動檢查
curl http://localhost:5000/health

# 查看 ngrok 狀態
curl http://localhost:4040/api/tunnels
```

---

## 🎯 完整！

如果所有步驟都通過，恭喜！您的本機環境已完全設定好。

### 每日使用流程

1. 雙擊 `快速啟動.bat`
2. 雙擊 `啟動ngrok.bat`
3. 複製 ngrok 網址
4. 更新 LINE Webhook（如網址有變）
5. 開始使用！

---

## 📖 進階指南

需要更多資訊？請參考：
- [本機執行指南.md](本機執行指南.md) - 完整說明
- [README.md](README.md) - 專案總覽
- [USAGE.md](USAGE.md) - 使用說明

---

**享受您的農業智能助手！** 🌾🤖
